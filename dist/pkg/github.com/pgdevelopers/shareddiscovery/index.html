<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>shareddiscovery - GoPages</title>

<link type="text/css" rel="stylesheet" href="/lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="/lib/godoc/jquery.js" defer></script>




<script>var goVersion = "go1.17";</script>
<script src="/lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="/pkg/github.com/pgdevelopers/shareddiscovery/">GoPages | Auto-generated docs</a></div>
<div class="top-heading" id="heading-narrow"><a href="/pkg/github.com/pgdevelopers/shareddiscovery/">GoPages</a></div>
<a href="#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package shareddiscovery
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/pgdevelopers/shareddiscovery"</code></dd>
			</dl>
			<dl>
			<dd><a href="#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="#pkg-index" class="indexLink">Index</a></dd>
			
				<dd><a href="#pkg-examples" class="examplesLink">Examples</a></dd>
			
			
				<dd><a href="#pkg-subdirectories">Subdirectories</a></dd>
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
SharedDiscovery is a shared library that supports getting data from the
discovery dynamodb tables based on several criteria, including:
</p>
<pre>- APIToken
- Country
- Workspace (tablename)
</pre>
<h3 id="hdr-Admin_Capabilities">Admin Capabilities</h3>
<p>
This library also supports the idea of admin calls that can get
any token needed. This is done using HMAC. For out purposes, the
private key is stored in Secrets Manager under the name of the
brand/environment.
</p>

				<div id="example_" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example</span></p>
		<p>Typical usage is to setup a variable with the interface type
and initialize that variable in your modules init function using
the New() function provided
</p>
		
		
			<p>Code:</p>
			<pre class="code">
var shareddiscovery SharedDiscoveryIFace

<span class="comment">// setup AWS Session</span>
session := session.New()

<span class="comment">// setup DynamoDB</span>
dynamo := dynamodb.New(session)

<span class="comment">// define a QueryInput</span>
query := QueryInput{Workspace: &#34;tableName&#34;}

<span class="comment">// setup shareddiscovery now</span>
shareddiscovery = New(dynamo)

<span class="comment">// call functions</span>
shareddiscovery.GetConfig(context.Background(), &#34;someApiToken&#34;, query)
</pre>
			
		
	</div>
</div>

			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="#QueryInput">type QueryInput</a></dd>
				
				
			
				
				<dd><a href="#SharedDiscovery">type SharedDiscovery</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#New">func New(dynamodb dynamodbiface.DynamoDBAPI) SharedDiscovery</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#SharedDiscovery.AdminGetAPIToken">func (service SharedDiscovery) AdminGetAPIToken(ctx context.Context, secretKey string, query QueryInput) (string, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#SharedDiscovery.GetConfig">func (service SharedDiscovery) GetConfig(ctx context.Context, apiToken string, query QueryInput) (map[string]interface{}, error)</a></dd>
				
			
				
				<dd><a href="#SharedDiscoveryIFace">type SharedDiscoveryIFace</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		
		<div id="pkg-examples">
			<h3>Examples</h3>
			<div class="js-expandAll expandAll collapsed">(Expand All)</div>
			<dl>
			
			<dd><a class="exampleLink" href="#example_">Package</a></dd>
			
			<dd><a class="exampleLink" href="#example_SharedDiscovery_AdminGetAPIToken">SharedDiscovery.AdminGetAPIToken</a></dd>
			
			<dd><a class="exampleLink" href="#example_SharedDiscovery_GetConfig_1">SharedDiscovery.GetConfig (1)</a></dd>
			
			<dd><a class="exampleLink" href="#example_SharedDiscovery_GetConfig_2">SharedDiscovery.GetConfig (2)</a></dd>
			
			</dl>
		</div>
		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go">shareddiscovery.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
		
			
			
			<h2 id="QueryInput">type <a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go#L32">QueryInput</a>
				<a class="permalink" href="#QueryInput">&#xb6;</a>
				
				
			</h2>
			<p>
QueryInput defines the values used to query dynamo with.
</p>

			<pre>type QueryInput struct {
<span id="QueryInput.AppName"></span>    AppName     <a href="/pkg/builtin/#string">string</a>
<span id="QueryInput.Brand"></span>    Brand       <a href="/pkg/builtin/#string">string</a>
<span id="QueryInput.Country"></span>    Country     <a href="/pkg/builtin/#string">string</a>
<span id="QueryInput.Environment"></span>    Environment <a href="/pkg/builtin/#string">string</a>
<span id="QueryInput.Signature"></span>    Signature   <a href="/pkg/builtin/#string">string</a>
<span id="QueryInput.QueryString"></span>    QueryString map[<a href="/pkg/builtin/#string">string</a>]<a href="/pkg/builtin/#string">string</a>
<span id="QueryInput.Workspace"></span>    Workspace   <a href="/pkg/builtin/#string">string</a>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="SharedDiscovery">type <a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go#L49">SharedDiscovery</a>
				<a class="permalink" href="#SharedDiscovery">&#xb6;</a>
				
				
			</h2>
			<p>
SharedDiscovery is a custom service object for interacting with the global config
</p>

			<pre>type SharedDiscovery struct {
    <a href="#SharedDiscoveryIFace">SharedDiscoveryIFace</a>
<span id="SharedDiscovery.DynamodbSvc"></span>    DynamodbSvc <a href="/pkg/github.com/aws/aws-sdk-go/service/dynamodb/dynamodbiface/">dynamodbiface</a>.<a href="/pkg/github.com/aws/aws-sdk-go/service/dynamodb/dynamodbiface/#DynamoDBAPI">DynamoDBAPI</a>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="New">func <a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go#L56">New</a>
					<a class="permalink" href="#New">&#xb6;</a>
					
					
				</h3>
				<pre>func New(dynamodb <a href="/pkg/github.com/aws/aws-sdk-go/service/dynamodb/dynamodbiface/">dynamodbiface</a>.<a href="/pkg/github.com/aws/aws-sdk-go/service/dynamodb/dynamodbiface/#DynamoDBAPI">DynamoDBAPI</a>) <a href="#SharedDiscovery">SharedDiscovery</a></pre>
				<p>
New is a constructor that takes a preconfigured dynamodbiface and returns an implementation of SharedDiscoveryIFace
Use this in your init function after creating your aws session and initializing dynamo.
</p>

				
				
			

			
				
				<h3 id="SharedDiscovery.AdminGetAPIToken">func (SharedDiscovery) <a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go#L109">AdminGetAPIToken</a>
					<a class="permalink" href="#SharedDiscovery.AdminGetAPIToken">&#xb6;</a>
					
					
				</h3>
				<pre>func (service <a href="#SharedDiscovery">SharedDiscovery</a>) AdminGetAPIToken(ctx <a href="/pkg/context/">context</a>.<a href="/pkg/context/#Context">Context</a>, secretKey <a href="/pkg/builtin/#string">string</a>, query <a href="#QueryInput">QueryInput</a>) (<a href="/pkg/builtin/#string">string</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				<p>
AdminGetAPIToken queries the dynamo table using the provided query
and returns the correct apiToken for the caller to use to then make
a request using the GetConfig call.
It first validates the HMAC signature against the provided secretKey/query params
to verify the caller is who they say they are.
</p>

				
				<div id="example_SharedDiscovery_AdminGetAPIToken" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example</span></p>
		<p>For making an admin call, a secretKey is required
and the query string is needed to regenerate the
signature correctly. The callers signature should also
be passed via in to verify.
</p>
		
		
			<p>Code:</p>
			<pre class="code">var shareddiscovery SharedDiscoveryIFace

<span class="comment">// setup AWS Session</span>
session := session.New()

<span class="comment">// setup DynamoDB</span>
dynamo := dynamodb.New(session)

<span class="comment">// define a QueryInput</span>
query := QueryInput{
    Workspace:   &#34;discovery_app&#34;,
    Signature:   &#34;e52af791ec66085081f993a42d2a02a4b1dc08ad7b9f030dac5a0c20d5a0c68c&#34;,
    Brand:       &#34;oralb&#34;,
    Environment: &#34;qa&#34;,
    Country:     &#34;US&#34;,
    QueryString: map[string]string{
        &#34;brand&#34;:       &#34;oralb&#34;,
        &#34;environment&#34;: &#34;qa&#34;,
        &#34;countryCode&#34;: &#34;US&#34;,
    },
}

<span class="comment">// setup shareddiscovery now</span>
shareddiscovery = New(dynamo)

<span class="comment">// call functions</span>
key, _ := shareddiscovery.AdminGetAPIToken(context.Background(), &#34;secretKey&#34;, query)
fmt.Println(key)
<span class="comment"></pre>
			
			<p>Output:</p>
			<pre class="output">ZWk3QFdBWVVTVjFFbFE0dlBPQDhhSURabmtmN0dEN1k=
</pre>
			
		
	</div>
</div>

				
			
				
				<h3 id="SharedDiscovery.GetConfig">func (SharedDiscovery) <a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go#L62">GetConfig</a>
					<a class="permalink" href="#SharedDiscovery.GetConfig">&#xb6;</a>
					
					
				</h3>
				<pre>func (service <a href="#SharedDiscovery">SharedDiscovery</a>) GetConfig(ctx <a href="/pkg/context/">context</a>.<a href="/pkg/context/#Context">Context</a>, apiToken <a href="/pkg/builtin/#string">string</a>, query <a href="#QueryInput">QueryInput</a>) (map[<a href="/pkg/builtin/#string">string</a>]interface{}, <a href="/pkg/builtin/#error">error</a>)</pre>
				<p>
GetConfig uses the provided `APIToken` to get the correct
configuration from the specified `tableName`.
</p>

				
				<div id="example_SharedDiscovery_GetConfig_1" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example (1)</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example (1)</span></p>
		<p>Passing in only the workspace as a query is best used when the
apiToken is unique for every row. In our case, this is the Firmware
table
</p>
		
		
			<p>Code:</p>
			<pre class="code">
session := session.New()
shared := New(dynamodb.New(session))
query := QueryInput{Workspace: &#34;tableName&#34;}
shared.GetConfig(context.Background(), &#34;apitoken&#34;, query)
</pre>
			
		
	</div>
</div>
<div id="example_SharedDiscovery_GetConfig_2" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example (2)</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example (2)</span></p>
		<p>Passing in a Country will get data from the table filtered by
the apiToken and Country. This is useful when the apiToken isn&#39;t
unique per row, but an apiToken can have multiple countries.
</p>
		
		
			<p>Code:</p>
			<pre class="code">
session := session.New()
shared := New(dynamodb.New(session))
query := QueryInput{Workspace: &#34;tableName&#34;, Country: &#34;US&#34;}
shared.GetConfig(context.Background(), &#34;apitoken&#34;, query)
</pre>
			
		
	</div>
</div>

				
			
		
			
			
			<h2 id="SharedDiscoveryIFace">type <a href="/src/github.com/pgdevelopers/shareddiscovery/shareddiscovery.go#L43">SharedDiscoveryIFace</a>
				<a class="permalink" href="#SharedDiscoveryIFace">&#xb6;</a>
				
				
			</h2>
			<p>
SharedDiscoveryIFace describes what is required for building a SharedDiscovery implementation.
</p>

			<pre>type SharedDiscoveryIFace interface {
    GetConfig(ctx <a href="/pkg/context/">context</a>.<a href="/pkg/context/#Context">Context</a>, apiToken <a href="/pkg/builtin/#string">string</a>, query <a href="#QueryInput">QueryInput</a>) (map[<a href="/pkg/builtin/#string">string</a>]interface{}, <a href="/pkg/builtin/#error">error</a>)
    AdminGetAPIToken(ctx <a href="/pkg/context/">context</a>.<a href="/pkg/context/#Context">Context</a>, secretKey <a href="/pkg/builtin/#string">string</a>, query <a href="#QueryInput">QueryInput</a>) (<a href="/pkg/builtin/#string">string</a>, <a href="/pkg/builtin/#error">error</a>)
}</pre>

			

			

			
			
			

			

			
		
	

	





	
	
		<h2 id="pkg-subdirectories">Subdirectories</h2>
	
	<div class="pkg-dir">
		<table>
			<tr>
				<th class="pkg-name">Name</th>
				<th class="pkg-synopsis">Synopsis</th>
			</tr>

			
			<tr>
				<td colspan="2"><a href="..">..</a></td>
			</tr>
			

			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="mocks/">mocks</a>
					</td>
				
					<td class="pkg-synopsis">
						
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 20px;">
						<a href="mocks/mock_dynamodbiface/">mock_dynamodbiface</a>
					</td>
				
					<td class="pkg-synopsis">
						Package mock_dynamodbiface is a generated GoMock package.
					</td>
				</tr>
			
		</table>
	</div>



<div id="footer">
Build version go1.17.<br>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>

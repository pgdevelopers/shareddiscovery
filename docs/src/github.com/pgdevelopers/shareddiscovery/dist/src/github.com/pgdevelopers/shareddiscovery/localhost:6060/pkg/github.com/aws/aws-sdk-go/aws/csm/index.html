<!DOCTYPE html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#375EAB"/>

  <title>csm - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../../lib/godoc/style.css"/>

<script>window.initFuncs = [];</script>
<script src="../../../../../../lib/godoc/jquery.js" defer=""></script>



<script>var goVersion = "go1.17";</script>
<script src="../../../../../../lib/godoc/godocs.js" defer=""></script>
</head>
<body>

<div id="lowframe" style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6060/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6060/pkg/">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">▽</span></a>
<form method="GET" action="http://localhost:6060/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required=""/><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package csm
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import &#34;github.com/aws/aws-sdk-go/aws/csm&#34;</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
				<dd><a href="index.html#pkg-examples" class="examplesLink">Examples</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
Package csm provides the Client Side Monitoring (CSM) client which enables
sending metrics via UDP connection to the CSM agent. This package provides
control options, and configuration for the CSM client. The client can be
controlled manually, or automatically via the SDK&#39;s Session configuration.
</p>
<h3 id="hdr-Enabling_CSM_client_via_SDK_s_Session_configuration">Enabling CSM client via SDK&#39;s Session configuration</h3>
<p>
The CSM client can be enabled automatically via SDK&#39;s Session configuration.
The SDK&#39;s session configuration enables the CSM client if the AWS_CSM_PORT
environment variable is set to a non-empty value.
</p>
<p>
The configuration options for the CSM client via the SDK&#39;s session
configuration are:
</p>
<pre>* AWS_CSM_PORT=&lt;port number&gt;
  The port number the CSM agent will receive metrics on.

* AWS_CSM_HOST=&lt;hostname or ip&gt;
  The hostname, or IP address the CSM agent will receive metrics on.
  Without port number.
</pre>
<h3 id="hdr-Manually_enabling_the_CSM_client">Manually enabling the CSM client</h3>
<p>
The CSM client can be started, paused, and resumed manually. The Start
function will enable the CSM client to publish metrics to the CSM agent. It
is safe to call Start concurrently, but if Start is called additional times
with different ClientID or address it will panic.
</p>
<pre>r, err := csm.Start(&#34;clientID&#34;, &#34;:31000&#34;)
if err != nil {
	panic(fmt.Errorf(&#34;failed starting CSM:  %v&#34;, err))
}
</pre>
<p>
When controlling the CSM client manually, you must also inject its request
handlers into the SDK&#39;s Session configuration for the SDK&#39;s API clients to
publish metrics.
</p>
<pre>sess, err := session.NewSession(&amp;aws.Config{})
if err != nil {
	panic(fmt.Errorf(&#34;failed loading session: %v&#34;, err))
}

// Add CSM client&#39;s metric publishing request handlers to the SDK&#39;s
// Session Configuration.
r.InjectHandlers(&amp;sess.Handlers)
</pre>
<h3 id="hdr-Controlling_CSM_client">Controlling CSM client</h3>
<p>
Once the CSM client has been enabled the Get function will return a Reporter
value that you can use to pause and resume the metrics published to the CSM
agent. If Get function is called before the reporter is enabled with the
Start function or via SDK&#39;s Session configuration nil will be returned.
</p>
<p>
The Pause method can be called to stop the CSM client publishing metrics to
the CSM agent. The Continue method will resume metric publishing.
</p>
<pre>// Get the CSM client Reporter.
r := csm.Get()

// Will pause monitoring
r.Pause()
resp, err = client.GetObject(&amp;s3.GetObjectInput{
	Bucket: aws.String(&#34;bucket&#34;),
	Key: aws.String(&#34;key&#34;),
})

// Resume monitoring
r.Continue()
</pre>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
				<dd><a href="index.html#pkg-constants">Constants</a></dd>
			
			
				<dd><a href="index.html#pkg-variables">Variables</a></dd>
			
			
				
				<dd><a href="index.html#AddressWithDefaults">func AddressWithDefaults(host, port string) string</a></dd>
			
			
				
				<dd><a href="index.html#Reporter">type Reporter</a></dd>
				
					
					<dd>    <a href="index.html#Get">func Get() *Reporter</a></dd>
				
					
					<dd>    <a href="index.html#Start">func Start(clientID string, url string) (*Reporter, error)</a></dd>
				
				
					
					<dd>    <a href="index.html#Reporter.Continue">func (rep *Reporter) Continue()</a></dd>
				
					
					<dd>    <a href="index.html#Reporter.InjectHandlers">func (rep *Reporter) InjectHandlers(handlers *request.Handlers)</a></dd>
				
					
					<dd>    <a href="index.html#Reporter.Pause">func (rep *Reporter) Pause()</a></dd>
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		
		<div id="pkg-examples">
			<h3>Examples</h3>
			<div class="js-expandAll expandAll collapsed">(Expand All)</div>
			<dl>
			
			<dd><a class="exampleLink" href="index.html#example_Start">Start</a></dd>
			
			</dl>
		</div>
		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/doc.go">doc.go</a>
			
				<a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/enable.go">enable.go</a>
			
				<a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/metric.go">metric.go</a>
			
				<a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/metric_chan.go">metric_chan.go</a>
			
				<a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/metric_exception.go">metric_exception.go</a>
			
				<a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/reporter.go">reporter.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
			<h2 id="pkg-constants">Constants</h2>
			
				
				<pre>const (
    <span class="comment">// DefaultPort is used when no port is specified.</span>
    <span id="DefaultPort">DefaultPort</span> = &#34;31000&#34;

    <span class="comment">// DefaultHost is the host that will be used when none is specified.</span>
    <span id="DefaultHost">DefaultHost</span> = &#34;127.0.0.1&#34;
)</pre>
			
				<p>
Client side metric handler names
</p>

				<pre>const (
    <span id="APICallMetricHandlerName">APICallMetricHandlerName</span>        = &#34;awscsm.SendAPICallMetric&#34;
    <span id="APICallAttemptMetricHandlerName">APICallAttemptMetricHandlerName</span> = &#34;awscsm.SendAPICallAttemptMetric&#34;
)</pre>
			
		
		
			<h2 id="pkg-variables">Variables</h2>
			
				
				<pre>var (
    <span class="comment">// MetricsChannelSize of metrics to hold in the channel</span>
    <span id="MetricsChannelSize">MetricsChannelSize</span> = 100
)</pre>
			
		
		
			
			
			<h2 id="AddressWithDefaults">func <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/enable.go?s=478:528#L14">AddressWithDefaults</a>
				<a class="permalink" href="index.html#AddressWithDefaults">¶</a>
				
				
			</h2>
			<pre>func AddressWithDefaults(host, port <a href="../../../../../builtin/index.html#string">string</a>) <a href="../../../../../builtin/index.html#string">string</a></pre>
			<p>
AddressWithDefaults returns a CSM address built from the host and port
values. If the host or port is not set, default values will be used
instead. If host is &#34;localhost&#34; it will be replaced with &#34;127.0.0.1&#34;.
</p>

			
			

		
		
			
			
			<h2 id="Reporter">type <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/reporter.go?s=272:399#L5">Reporter</a>
				<a class="permalink" href="index.html#Reporter">¶</a>
				
				
			</h2>
			<p>
Reporter will gather metrics of API requests made and
send those metrics to the CSM endpoint.
</p>

			<pre>type Reporter struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="Get">func <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/enable.go?s=2017:2037#L74">Get</a>
					<a class="permalink" href="index.html#Get">¶</a>
					
					
				</h3>
				<pre>func Get() *<a href="index.html#Reporter">Reporter</a></pre>
				<p>
Get will return a reporter if one exists, if one does not exist, nil will
be returned.
</p>

				
				
			
				
				<h3 id="Start">func <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/enable.go?s=1387:1445#L48">Start</a>
					<a class="permalink" href="index.html#Start">¶</a>
					
					
				</h3>
				<pre>func Start(clientID <a href="../../../../../builtin/index.html#string">string</a>, url <a href="../../../../../builtin/index.html#string">string</a>) (*<a href="index.html#Reporter">Reporter</a>, <a href="../../../../../builtin/index.html#error">error</a>)</pre>
				<p>
Start will start a long running go routine to capture
client side metrics. Calling start multiple time will only
start the metric listener once and will panic if a different
client ID or port is passed in.
</p>
<pre>r, err := csm.Start(&#34;clientID&#34;, &#34;127.0.0.1:31000&#34;)
if err != nil {
	panic(fmt.Errorf(&#34;expected no error, but received %v&#34;, err))
}
sess := session.NewSession()
r.InjectHandlers(sess.Handlers)

svc := s3.New(sess)
out, err := svc.GetObject(&amp;s3.GetObjectInput{
	Bucket: aws.String(&#34;bucket&#34;),
	Key: aws.String(&#34;key&#34;),
})
</pre>

				<div id="example_Start" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example</span></p>
		
		
		
			<p>Code:</p>
			<pre class="code">r, err := csm.Start(&#34;clientID&#34;, &#34;:31000&#34;)
if err != nil {
    panic(fmt.Errorf(&#34;failed starting CSM:  %v&#34;, err))
}

sess, err := session.NewSession(&amp;aws.Config{})
if err != nil {
    panic(fmt.Errorf(&#34;failed loading session: %v&#34;, err))
}

r.InjectHandlers(&amp;sess.Handlers)

client := s3.New(sess)
client.GetObject(&amp;s3.GetObjectInput{
    Bucket: aws.String(&#34;bucket&#34;),
    Key:    aws.String(&#34;key&#34;),
})

<span class="comment">// Pauses monitoring</span>
r.Pause()
client.GetObject(&amp;s3.GetObjectInput{
    Bucket: aws.String(&#34;bucket&#34;),
    Key:    aws.String(&#34;key&#34;),
})

<span class="comment">// Resume monitoring</span>
r.Continue()
</pre>
			
		
	</div>
</div>

				
			

			
				
				<h3 id="Reporter.Continue">func (*Reporter) <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/reporter.go?s=4478:4509#L194">Continue</a>
					<a class="permalink" href="index.html#Reporter.Continue">¶</a>
					
					
				</h3>
				<pre>func (rep *<a href="index.html#Reporter">Reporter</a>) Continue()</pre>
				<p>
Continue will reopen the metric channel and allow for monitoring to be
resumed. It is safe to call concurrently with other calls to Continue, but
if called concurently with Pause can lead to unexpected state.
</p>

				
				
				
			
				
				<h3 id="Reporter.InjectHandlers">func (*Reporter) <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/reporter.go?s=5492:5555#L231">InjectHandlers</a>
					<a class="permalink" href="index.html#Reporter.InjectHandlers">¶</a>
					
					
				</h3>
				<pre>func (rep *<a href="index.html#Reporter">Reporter</a>) InjectHandlers(handlers *<a href="../request/index.html">request</a>.<a href="../request/index.html#Handlers">Handlers</a>)</pre>
				<p>
InjectHandlers will will enable client side metrics and inject the proper
handlers to handle how metrics are sent.
</p>
<p>
InjectHandlers is NOT safe to call concurrently. Calling InjectHandlers
multiple times may lead to unexpected behavior, (e.g. duplicate metrics).
</p>
<pre>// Start must be called in order to inject the correct handlers
r, err := csm.Start(&#34;clientID&#34;, &#34;127.0.0.1:8094&#34;)
if err != nil {
	panic(fmt.Errorf(&#34;expected no error, but received %v&#34;, err))
}

sess := session.NewSession()
r.InjectHandlers(&amp;sess.Handlers)

// create a new service client with our client side metric session
svc := s3.New(sess)
</pre>

				
				
				
			
				
				<h3 id="Reporter.Pause">func (*Reporter) <a href="http://localhost:6060/src/github.com/aws/aws-sdk-go/aws/csm/reporter.go?s=4148:4176#L180">Pause</a>
					<a class="permalink" href="index.html#Reporter.Pause">¶</a>
					
					
				</h3>
				<pre>func (rep *<a href="index.html#Reporter">Reporter</a>) Pause()</pre>
				<p>
Pause will pause the metric channel preventing any new metrics from being
added. It is safe to call concurrently with other calls to Pause, but if
called concurently with Continue can lead to unexpected state.
</p>

				
				
				
			
		
	

	







<div id="footer">
Build version go1.17.<br/>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6060/LICENSE">BSD license</a>.<br/>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->


</body></html>